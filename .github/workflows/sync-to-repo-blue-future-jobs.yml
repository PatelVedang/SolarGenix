name: Sync to Repo Blue Future Jobs

on:
  push:
    branches:
      - BETA
  pull_request:
    branches:
      - BETA

jobs:
  sync_code:
    runs-on: ubuntu-latest

    steps:
    # Checkout Repo A (current repository - BETA branch)
    - name: Checkout Repo A
      uses: actions/checkout@v3

    # Set up Git with your identity
    - name: Set up Git
      run: |
        git config --global user.name "parimal-ts"
        git config --global user.email "parimal.patel@technostacks.com"

    # Clone Repo B (Blue Future Jobs)
    - name: Clone Repo Blue Future Jobs
      run: |
        git clone --branch DRF https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/technostacksgit/blue-future-backend-python-django.git target-repo

    # Copy changes from Repo A to Repo B (excluding .git)
    - name: Copy Code from Repo A to Repo B
      run: |
        rsync -av --exclude='.git/' ./ ./target-repo/  # Copy all files from Repo A to Repo B, excluding .git

    # Commit and push changes to Repo B
    - name: Commit and Push Changes to Repo B
      run: |
        cd target-repo
        git add .
        git commit -m "feat: Sync code from Repo A BETA branch"
        git push origin DRF

    # Optional: Clean up sensitive data (GitHub Token)
    - name: Clean up
      run: |
        rm -rf target-repo
